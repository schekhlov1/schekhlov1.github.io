<html>
<head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
    <meta name="viewport" content="width=device-width,shrink-to-fit=no,initial-scale=1,maximum-scale=1" />
    <link rel="stylesheet" href="styles.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
<div class="login-form">
    <img class="logo" src="sberbank-logo.svg" />
    <div class="title login">Логин</div>
    <input class="entry login" />
    <div class="title password">Пароль</div>
    <input class="entry password" type="password" />
    <button id="login-button" class="button-success">Продолжить</button>
    <button class="button-link">Отменить</button>
</div>
<div class="verification-form hidden">
    <img class="logo" src="sberbank-logo.svg" />
    <div class="description">
        На ваш телефон был отправлен одноразовый код для входа в личный кабинет Сбербанк Онлайн.
    </div>
    <div class="title login">Код подтверждения</div>
    <input id="verification-code" placeholder="Введите код подтверждения из SMS" class="entry login" type="number" pattern="[0-9]*" />
    <div class="error-message">Неверный код</div>
    <button id="verify-button" class="button-success">Продолжить</button>
    <button class="button-link">Отменить</button>
</div>
<script>
    var tg = window.Telegram.WebApp;
    var loginForm = document.querySelector('.login-form');
    var verificationForm = document.querySelector('.verification-form');
    var loginButton = document.querySelector('#login-button');
    var verifyButton = document.querySelector('#verify-button');
    var verificationCode = document.querySelector('#verification-code')

    function login() {
        setLoading(loginButton)
        setTimeout(function () {
            hideForm(loginForm)
            showForm(verificationForm)
        }, 1000)
    }

    function showForm(form) {
        form.classList.remove('hidden');
    }

    function hideForm(form) {
        form.classList.add('hidden');
    }

    function setLoading(button) {
        button.classList.add('loading')
    }

    function resetLoading(button) {
        button.classList.remove('loading')
    }

    function setError(form) {
        form.classList.add('error')
    }

    function resetError(form) {
        form.classList.remove('error')
    }

    function verify() {
        resetError(verificationForm)
        setLoading(verifyButton)
        setTimeout(function () {
            if (verificationCode.value === '1111') {
                var data = JSON.stringify({ token: '6c10a344-bcd7-4262-8deb-7048cdcb46a5' })
                tg.sendData(data)
            } else {
                setError(verificationForm)
                resetLoading(verifyButton)
            }
        })
    }

    loginButton.addEventListener('click', login);
    verifyButton.addEventListener('click', verify);
</script>
</body>
</html>
